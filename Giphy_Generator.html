<!DOCTYPE html>
<html lang="en">
    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.1.3/css/bootstrap.min.css" integrity="sha384-MCw98/SFnGE8fJT3GXwEOngsV7Zt27NXFoaoApmYm81iuXoPkFOJwJ8ERdknLPMO" crossorigin="anonymous">
    <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.1.3/js/bootstrap.min.js" integrity="sha384-ChfqqxuZUCnJSK3+MXmPNIyE6ZbWh2IMqE241rYiqJxyMiZ6OW/JmZQ5stwEULTy" crossorigin="anonymous"></script>
<head>
  <meta charset="utf-8">
  <title>Giph Generator App</title>
  <style type="text/css">
    button,
    div,
    form,
    input {
      margin: 10px;
    }
  </style>
</head>

<body>

  <div class="container">
    <h1>Giphy Search</h1>
<!-- Rendered buttons will get dumped here  -->
    <div id="buttons-view"></div>

    <div class="row">
        
        <div class="col">
<!-- Generated gifs will get dumped here  -->
        <div id="giph-container"></div>
        </div>

        <div class="col">
          <h3>Create Your Own Giphy Buttons!</h3>
            <form id="giph-form">
                <label for="giph-input">Search Giphy:</label>
                <input type="text" id="giph-input"><br>
          
    <!-- Button triggers new giph button to be added into #giph-container-->
                <input id="add-giph" type="submit" value="Add Your Own!">
            </form>
        </div>
      </div>
   
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.2.1/jquery.min.js"></script>
    <script type="text/javascript">
      // Initial array of giphs
      var giphs = ["The Matrix", "The Notebook", "Mr. Nobody", "The Lion King"];
      // displayGiphRating function re-renders the HTML to display the appropriate content
      function displayGiphRating() {

        var searchTerm = $(this).attr("data-name");
        var queryURL = "https://api.giphy.com/v1/gifs/search?api_key=sNcKr7LScAoiuiJSCdfmJvALAAXq8j89&q=" +
        searchTerm + "&limit=10&offset=0&lang=en";
        // Creates AJAX call for the specific giph button being clicked
        $.ajax({
          url: queryURL,
          method: "GET"
        })
        .then(function(response) {
            console.log(response);
            var results = response.data;

            for (var i = 0; i < results.length; i++){
            
                // Creates a div to hold the giph
                let giphDiv = $("<div class='giph-div'>");
                var rating = results[i].rating;
                let pOne = $('<p>').text('Rating: ' + rating);
                giphDiv.append(pOne);
                
                let pic = $('<img>').attr({"src": results[i].images.fixed_height_still.url, 
                                            "data-state": "still",
                                            "data-still": results[i].images.fixed_height_still.url,
                                            "data-animate": results[i].images.fixed_height.url,
                                            "class": "gif"});

                let picAni = $('<img>').attr("src", results[i].images.fixed_height.url);

                console.log(results);
                
                giphDiv.append(pic);

                 $("#giph-container").prepend(giphDiv);
            }

            $(".gif").on("click", function() {
                var state = $(this).attr('data-state');      
                    if (state === 'still') {
                    $(this).attr("src", $(this).attr('data-animate'));
                    $(this).attr("data-state", "animate");
                    } else {
                        $(this).attr("src", $(this).attr("data-still"));
                        $(this).attr("data-state", "still");
                    }
                });
            

        });

      }

      // Function for displaying giph data
      function renderButtons() {

        // Deletes the giphs prior to adding new giphs
        // (this is necessary otherwise you will have repeat buttons)
        $("#buttons-view").empty();
        // Loops through the array of giphs
        for (var i = 0; i < giphs.length; i++) {

          // Then dynamicaly generates buttons for each giph in the array
          // This code $("<button>") is all jQuery needs to create the beginning and end tag. (<button></button>)
          var a = $("<button>");
          // Adds a class of giph to our button
          a.addClass("giph");
          // Added a data-attribute
          a.attr("data-name", giphs[i]);
          // Provided the initial button text
          a.text(giphs[i]);
          // Added the button to the buttons-view div
          $("#buttons-view").append(a);
        }
      }

      // This function handles events where the add giph button is clicked
      $("#add-giph").on("click", function(event) {
        event.preventDefault();

        // This line of code will grab the input from the textbox
        var giph = $("#giph-input").val().trim();

        // The giph from the textbox is then added to our array
        giphs.push(giph);

        // Calling renderButtons which handles the processing of our giph array
        renderButtons();
      });

      // Adding click event listeners to all elements with a class of "giph"
      $(document).on("click", ".giph", displayGiphRating);

      // Calling the renderButtons function to display the intial buttons
      renderButtons();
    </script>
  </div>
</body>

</html>
